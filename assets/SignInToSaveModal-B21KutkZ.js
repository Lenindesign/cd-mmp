import{i as w,u as k,r as n,s as M,t as R,j as e}from"./iframe-BmlzIRR_.js";import{r as E}from"./index-GS6FdTf2.js";import{X as A}from"./x-DGb687Pz.js";import{B as S}from"./bookmark-D6Vrcg_W.js";import{c as G}from"./createLucideIcon-DgLfEH63.js";import{F as L}from"./file-text-DUNK_hE0.js";const z=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],P=G("play",z),j="https://accounts.google.com/gsi/client",U=s=>{switch(s){case"vehicle":return"vehicle";case"article":return"article";case"video":return"video";default:return"item"}},F=s=>{switch(s){case"vehicle":return e.jsx(S,{size:20});case"article":return e.jsx(L,{size:20});case"video":return e.jsx(P,{size:20});default:return e.jsx(S,{size:20})}},B=s=>{try{const d=s.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),r=decodeURIComponent(atob(d).split("").map(m=>"%"+("00"+m.charCodeAt(0).toString(16)).slice(-2)).join("")),o=JSON.parse(r);return{id:o.sub,email:o.email,name:o.name,given_name:o.given_name,family_name:o.family_name,picture:o.picture,email_verified:o.email_verified,locale:o.locale}}catch(l){return console.error("Failed to decode JWT:",l),null}},X=({isOpen:s,onClose:l,itemType:d,itemName:r,itemImage:o})=>{const m=w(),{socialSignIn:y}=k(),[_,u]=n.useState(!1),[h,v]=n.useState(!1),[f,g]=n.useState(!1),x=n.useRef(null),i=n.useRef(!1),b=n.useCallback(t=>{console.log("[SignInToSaveModal] Google credential response received");const a=B(t.credential);a?(console.log("[SignInToSaveModal] User decoded:",a.email),M(a),window.dispatchEvent(new CustomEvent("auth-google-signin",{detail:{...a,skipOnboarding:!0,source:"save_modal"}})),R("google_one_tap",{email:a.email,name:a.name,user_id:a.id}),u(!0),setTimeout(()=>{u(!1),l()},200)):(console.error("[SignInToSaveModal] Failed to decode user information"),v(!1))},[l]);n.useEffect(()=>{if(!s||i.current)return;if(window.google?.accounts?.id){console.log("[SignInToSaveModal] Google script already loaded"),g(!0),i.current=!0;return}const t=document.querySelector(`script[src="${j}"]`);if(t){console.log("[SignInToSaveModal] Script tag exists, waiting for load"),t.addEventListener("load",()=>{g(!0),i.current=!0}),window.google?.accounts?.id&&(g(!0),i.current=!0);return}console.log("[SignInToSaveModal] Loading Google Identity Services script");const a=document.createElement("script");a.src=j,a.async=!0,a.defer=!0,a.onload=()=>{console.log("[SignInToSaveModal] Script loaded"),g(!0),i.current=!0},a.onerror=()=>{console.error("[SignInToSaveModal] Failed to load Google Identity Services script")},document.head.appendChild(a)},[s]),n.useEffect(()=>{!s||!f||x.current},[s,f,b]);const c=()=>{u(!0),setTimeout(()=>{u(!1),l()},200)},I=()=>{c(),m("/sign-in")},C=()=>{c(),m("/sign-up")},N=async()=>{v(!0);try{await y("apple"),c()}catch(t){console.error("Apple sign-in failed:",t),v(!1)}};if(!s)return null;const p=U(d),T=()=>F(d);return E.createPortal(e.jsx("div",{className:`save-modal__overlay ${_?"save-modal__overlay--closing":""}`,onClick:c,children:e.jsxs("div",{className:`save-modal ${_?"save-modal--closing":""}`,onClick:t=>t.stopPropagation(),role:"dialog","aria-modal":"true","aria-labelledby":"save-modal-title",children:[e.jsx("button",{className:"save-modal__close",onClick:c,"aria-label":"Close modal",children:e.jsx(A,{size:20})}),e.jsx("div",{className:"save-modal__icon-header",children:e.jsx("div",{className:"save-modal__icon-circle",children:e.jsx(T,{})})}),e.jsxs("div",{className:"save-modal__content",children:[e.jsxs("h2",{id:"save-modal-title",className:"save-modal__title",children:["Sign in to save this ",p]}),r&&e.jsx("p",{className:"save-modal__item-name",children:r}),e.jsxs("p",{className:"save-modal__description",children:["Create a free account to save ",p,"s, get price alerts, and access your research from any device."]}),o&&e.jsx("div",{className:"save-modal__preview",children:e.jsx("img",{src:o,alt:r||`${p} preview`})})]}),e.jsxs("div",{className:"save-modal__actions",children:[e.jsxs("div",{className:"save-modal__social",children:[e.jsxs("button",{className:"save-modal__social-btn save-modal__social-btn--apple",onClick:N,disabled:h,children:[e.jsx("svg",{viewBox:"0 0 24 24",width:"18",height:"18",children:e.jsx("path",{fill:"currentColor",d:"M17.05 20.28c-.98.95-2.05.8-3.08.35-1.09-.46-2.09-.48-3.24 0-1.44.62-2.2.44-3.06-.35C2.79 15.25 3.51 7.59 9.05 7.31c1.35.07 2.29.74 3.08.8 1.18-.24 2.31-.93 3.57-.84 1.51.12 2.65.72 3.4 1.8-3.12 1.87-2.38 5.98.48 7.13-.57 1.5-1.31 2.99-2.54 4.09l.01-.01zM12.03 7.25c-.15-2.23 1.66-4.07 3.74-4.25.29 2.58-2.34 4.5-3.74 4.25z"})}),h?"Signing in...":"Continue with Apple"]}),e.jsx("div",{ref:x,className:"save-modal__google-btn-container",style:{minHeight:"44px"}})]}),e.jsx("div",{className:"save-modal__divider",children:e.jsx("span",{children:"or"})}),e.jsx("button",{className:"save-modal__btn save-modal__btn--primary",onClick:C,children:"Create Free Account"}),e.jsx("button",{className:"save-modal__btn save-modal__btn--secondary",onClick:I,children:"Sign In"})]}),e.jsxs("p",{className:"save-modal__terms",children:["By continuing, you agree to our ",e.jsx("a",{href:"/terms",children:"Terms"})," and ",e.jsx("a",{href:"/privacy",children:"Privacy Policy"})]})]})}),document.body)};export{P,X as S};
