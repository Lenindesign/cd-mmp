import{i as M,u as G,r as n,s as k,t as E,j as e}from"./iframe--VFCZUcI.js";import{r as z}from"./index-Cm4Bs538.js";import{X as R}from"./x-DFZ9uvXk.js";import{B as y}from"./bookmark-CmFvM05p.js";import{c as L}from"./createLucideIcon-v1gFwtaC.js";import{F as A}from"./file-text-C7pA6Agd.js";const P=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],U=L("play",P),j="770345592048-d0gu8vgcq1eellqeiiq32d6j8r7hd7nb.apps.googleusercontent.com",I="https://accounts.google.com/gsi/client",B=a=>{switch(a){case"vehicle":return"vehicle";case"article":return"article";case"video":return"video";default:return"item"}},F=a=>{switch(a){case"vehicle":return e.jsx(y,{size:20});case"article":return e.jsx(A,{size:20});case"video":return e.jsx(U,{size:20});default:return e.jsx(y,{size:20})}},q=a=>{try{const u=a.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),i=decodeURIComponent(atob(u).split("").map(g=>"%"+("00"+g.charCodeAt(0).toString(16)).slice(-2)).join("")),s=JSON.parse(i);return{id:s.sub,email:s.email,name:s.name,given_name:s.given_name,family_name:s.family_name,picture:s.picture,email_verified:s.email_verified,locale:s.locale}}catch(l){return console.error("Failed to decode JWT:",l),null}},X=({isOpen:a,onClose:l,itemType:u,itemName:i,itemImage:s})=>{const g=M(),{socialSignIn:b}=G(),[h,m]=n.useState(!1),[f,p]=n.useState(!1),[S,v]=n.useState(!1),r=n.useRef(null),c=n.useRef(!1),x=n.useCallback(t=>{console.log("[SignInToSaveModal] Google credential response received");const o=q(t.credential);o?(console.log("[SignInToSaveModal] User decoded:",o.email),k(o),window.dispatchEvent(new CustomEvent("auth-google-signin",{detail:o})),E("google_one_tap",{email:o.email,name:o.name,user_id:o.id}),m(!0),setTimeout(()=>{m(!1),l()},200)):(console.error("[SignInToSaveModal] Failed to decode user information"),p(!1))},[l]);n.useEffect(()=>{if(!a||c.current)return;if(window.google?.accounts?.id){console.log("[SignInToSaveModal] Google script already loaded"),v(!0),c.current=!0;return}const t=document.querySelector(`script[src="${I}"]`);if(t){console.log("[SignInToSaveModal] Script tag exists, waiting for load"),t.addEventListener("load",()=>{v(!0),c.current=!0}),window.google?.accounts?.id&&(v(!0),c.current=!0);return}console.log("[SignInToSaveModal] Loading Google Identity Services script");const o=document.createElement("script");o.src=I,o.async=!0,o.defer=!0,o.onload=()=>{console.log("[SignInToSaveModal] Script loaded"),v(!0),c.current=!0},o.onerror=()=>{console.error("[SignInToSaveModal] Failed to load Google Identity Services script")},document.head.appendChild(o)},[a]),n.useEffect(()=>{if(!a||!S||!r.current||!j)return;const t=setTimeout(()=>{if(!(!window.google?.accounts?.id||!r.current)){console.log("[SignInToSaveModal] Initializing Google button");try{window.google.accounts.id.initialize({client_id:j,callback:x,auto_select:!1,cancel_on_tap_outside:!1,context:"signin",itp_support:!0,use_fedcm_for_prompt:!1}),window.google.accounts.id.renderButton(r.current,{type:"standard",theme:"outline",size:"large",text:"continue_with",shape:"rectangular",logo_alignment:"left",width:r.current.offsetWidth||320}),console.log("[SignInToSaveModal] Google button rendered")}catch(o){console.error("[SignInToSaveModal] Error initializing Google button:",o)}}},100);return()=>clearTimeout(t)},[a,S,x]);const d=()=>{m(!0),setTimeout(()=>{m(!1),l()},200)},w=()=>{d(),g("/sign-in")},T=()=>{d(),g("/sign-up")},C=async()=>{p(!0);try{await b("apple"),d()}catch(t){console.error("Apple sign-in failed:",t),p(!1)}};if(!a)return null;const _=B(u),N=()=>F(u);return z.createPortal(e.jsx("div",{className:`save-modal__overlay ${h?"save-modal__overlay--closing":""}`,onClick:d,children:e.jsxs("div",{className:`save-modal ${h?"save-modal--closing":""}`,onClick:t=>t.stopPropagation(),role:"dialog","aria-modal":"true","aria-labelledby":"save-modal-title",children:[e.jsx("button",{className:"save-modal__close",onClick:d,"aria-label":"Close modal",children:e.jsx(R,{size:20})}),e.jsx("div",{className:"save-modal__icon-header",children:e.jsx("div",{className:"save-modal__icon-circle",children:e.jsx(N,{})})}),e.jsxs("div",{className:"save-modal__content",children:[e.jsxs("h2",{id:"save-modal-title",className:"save-modal__title",children:["Sign in to save this ",_]}),i&&e.jsx("p",{className:"save-modal__item-name",children:i}),e.jsxs("p",{className:"save-modal__description",children:["Create a free account to save ",_,"s, get price alerts, and access your research from any device."]}),s&&e.jsx("div",{className:"save-modal__preview",children:e.jsx("img",{src:s,alt:i||`${_} preview`})})]}),e.jsxs("div",{className:"save-modal__actions",children:[e.jsxs("div",{className:"save-modal__social",children:[e.jsxs("button",{className:"save-modal__social-btn save-modal__social-btn--apple",onClick:C,disabled:f,children:[e.jsx("svg",{viewBox:"0 0 24 24",width:"18",height:"18",children:e.jsx("path",{fill:"currentColor",d:"M17.05 20.28c-.98.95-2.05.8-3.08.35-1.09-.46-2.09-.48-3.24 0-1.44.62-2.2.44-3.06-.35C2.79 15.25 3.51 7.59 9.05 7.31c1.35.07 2.29.74 3.08.8 1.18-.24 2.31-.93 3.57-.84 1.51.12 2.65.72 3.4 1.8-3.12 1.87-2.38 5.98.48 7.13-.57 1.5-1.31 2.99-2.54 4.09l.01-.01zM12.03 7.25c-.15-2.23 1.66-4.07 3.74-4.25.29 2.58-2.34 4.5-3.74 4.25z"})}),f?"Signing in...":"Continue with Apple"]}),e.jsx("div",{ref:r,className:"save-modal__google-btn-container",style:{minHeight:"44px"}})]}),e.jsx("div",{className:"save-modal__divider",children:e.jsx("span",{children:"or"})}),e.jsx("button",{className:"save-modal__btn save-modal__btn--primary",onClick:T,children:"Create Free Account"}),e.jsx("button",{className:"save-modal__btn save-modal__btn--secondary",onClick:w,children:"Sign In"})]}),e.jsxs("p",{className:"save-modal__terms",children:["By continuing, you agree to our ",e.jsx("a",{href:"/terms",children:"Terms"})," and ",e.jsx("a",{href:"/privacy",children:"Privacy Policy"})]})]})}),document.body)};export{U as P,X as S};
