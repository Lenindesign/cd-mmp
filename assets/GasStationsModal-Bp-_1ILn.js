import{r as i,j as s}from"./iframe-CGJgdeWY.js";import{A as C,M as I,a as y,I as G,u as O}from"./index.modern-CeCbsjUK.js";import{F as h}from"./fuel-DjWI1r8B.js";import{X as E}from"./x-EfpZETKB.js";import{L as w}from"./loader-circle-Cr2B62MW.js";import{M as N}from"./map-pin-C_J_K5rx.js";import{N as v}from"./navigation-DKr4V-tw.js";import{E as L}from"./external-link-Bi1Kwin2.js";const M="AIzaSyBEQULQb-uUX-MRIOxSOiLqjy0beake1QM",$=({userLocation:e,onStationsFound:o})=>{const d=O();return i.useEffect(()=>{if(!d)return;const l=async()=>{try{const{Place:g}=await google.maps.importLibrary("places"),c={fields:["displayName","location","formattedAddress","rating","userRatingCount","regularOpeningHours","id"],locationRestriction:{center:e,radius:8e3},includedPrimaryTypes:["gas_station"],maxResultCount:20},{places:r}=await g.searchNearby(c);if(r&&r.length>0){const _=r.map((n,t)=>({id:n.id||`station-${t}`,name:n.displayName||"Gas Station",address:n.formattedAddress||"",lat:n.location?.lat()||e.lat,lng:n.location?.lng()||e.lng,rating:n.rating,totalRatings:n.userRatingCount,isOpen:n.regularOpeningHours?.isOpen?.(),placeId:n.id}));o(_)}}catch(g){console.error("Error searching for gas stations:",g),m()}},m=()=>{const g=new google.maps.places.PlacesService(d),c={location:e,radius:8e3,type:"gas_station"};g.nearbySearch(c,(r,_)=>{if(_===google.maps.places.PlacesServiceStatus.OK&&r){const n=r.slice(0,20).map((t,p)=>({id:t.place_id||`station-${p}`,name:t.name||"Gas Station",address:t.vicinity||"",lat:t.geometry?.location?.lat()||e.lat,lng:t.geometry?.location?.lng()||e.lng,rating:t.rating,totalRatings:t.user_ratings_total,isOpen:t.opening_hours?.isOpen?.(),placeId:t.place_id}));o(n)}})};l()},[d,e,o]),null},z=({station:e,isSelected:o,showInfoWindow:d,onClick:l,onCloseInfoWindow:m})=>s.jsxs(s.Fragment,{children:[s.jsx(y,{position:{lat:e.lat,lng:e.lng},onClick:l,children:s.jsx("div",{className:`gas-marker ${o?"gas-marker--selected":""}`,children:s.jsx(h,{size:16})})}),d&&s.jsx(G,{position:{lat:e.lat,lng:e.lng},onCloseClick:m,pixelOffset:[0,-40],children:s.jsxs("div",{className:"gas-info-window",children:[s.jsx("h4",{className:"gas-info-window__name",children:e.name}),s.jsx("p",{className:"gas-info-window__address",children:e.address}),e.rating&&s.jsxs("div",{className:"gas-info-window__rating",children:[s.jsxs("span",{className:"gas-info-window__stars",children:["★ ",e.rating.toFixed(1)]}),e.totalRatings&&s.jsxs("span",{className:"gas-info-window__count",children:["(",e.totalRatings," reviews)"]})]}),e.isOpen!==void 0&&s.jsx("span",{className:`gas-info-window__status ${e.isOpen?"gas-info-window__status--open":"gas-info-window__status--closed"}`,children:e.isOpen?"Open Now":"Closed"}),s.jsx("div",{className:"gas-info-window__actions",children:s.jsxs("a",{href:`https://www.google.com/maps/dir/?api=1&destination=${e.lat},${e.lng}&destination_place_id=${e.placeId}`,target:"_blank",rel:"noopener noreferrer",className:"gas-info-window__directions",children:[s.jsx(v,{size:14}),"Directions"]})})]})})]}),P=({isOpen:e,onClose:o,vehicleName:d})=>{const[l,m]=i.useState(null),[g,c]=i.useState(!0),[r,_]=i.useState(null),[n,t]=i.useState([]),[p,x]=i.useState(null),[f,S]=i.useState(!0),[b,j]=i.useState(null);i.useEffect(()=>{e&&(c(!0),_(null),"geolocation"in navigator?navigator.geolocation.getCurrentPosition(a=>{m({lat:a.coords.latitude,lng:a.coords.longitude}),c(!1)},a=>{console.error("Geolocation error:",a),m({lat:34.0522,lng:-118.2437}),_("Unable to get your location. Showing results for Los Angeles."),c(!1)},{timeout:1e4,enableHighAccuracy:!0}):(m({lat:34.0522,lng:-118.2437}),_("Geolocation not supported. Showing results for Los Angeles."),c(!1)))},[e]),i.useEffect(()=>{const a=u=>{u.key==="Escape"&&o()};return e&&(document.addEventListener("keydown",a),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",a),document.body.style.overflow=""}},[e,o]);const k=i.useCallback(a=>{t(a),S(!1)},[]);return e?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"gas-stations-modal__backdrop",onClick:o,"aria-hidden":"true"}),s.jsxs("div",{className:"gas-stations-modal",role:"dialog","aria-modal":"true","aria-labelledby":"gas-stations-modal-title",children:[s.jsxs("div",{className:"gas-stations-modal__header",children:[s.jsxs("div",{className:"gas-stations-modal__header-content",children:[s.jsx(h,{size:24}),s.jsxs("div",{children:[s.jsx("h2",{id:"gas-stations-modal-title",className:"gas-stations-modal__title",children:"Gas Stations Near You"}),d&&s.jsxs("p",{className:"gas-stations-modal__subtitle",children:["Find fuel for your ",d]})]})]}),s.jsx("button",{className:"gas-stations-modal__close",onClick:o,"aria-label":"Close modal",children:s.jsx(E,{size:24})})]}),s.jsx("div",{className:"gas-stations-modal__content",children:g?s.jsxs("div",{className:"gas-stations-modal__loading",children:[s.jsx(w,{size:32,className:"gas-stations-modal__spinner"}),s.jsx("p",{children:"Getting your location..."})]}):l?s.jsxs("div",{className:"gas-stations-modal__map-container",children:[r&&s.jsxs("div",{className:"gas-stations-modal__location-warning",children:[s.jsx(N,{size:16}),r]}),s.jsxs("div",{className:"gas-stations-modal__layout",children:[s.jsxs("div",{className:"gas-stations-modal__sidebar",children:[s.jsx("div",{className:"gas-stations-modal__sidebar-header",children:s.jsx("h3",{children:f?"Searching...":`${n.length} Stations Found`})}),f?s.jsx("div",{className:"gas-stations-modal__sidebar-loading",children:s.jsx(w,{size:24,className:"gas-stations-modal__spinner"})}):n.length===0?s.jsx("div",{className:"gas-stations-modal__sidebar-empty",children:s.jsx("p",{children:"No gas stations found nearby"})}):s.jsx("ul",{className:"gas-stations-modal__list",children:n.map(a=>s.jsxs("li",{className:`gas-stations-modal__list-item ${p?.id===a.id?"gas-stations-modal__list-item--selected":""}`,onClick:()=>x(a),children:[s.jsx("div",{className:"gas-stations-modal__station-icon",children:s.jsx(h,{size:18})}),s.jsxs("div",{className:"gas-stations-modal__station-info",children:[s.jsx("h4",{className:"gas-stations-modal__station-name",children:a.name}),s.jsx("p",{className:"gas-stations-modal__station-address",children:a.address}),s.jsxs("div",{className:"gas-stations-modal__station-meta",children:[a.rating&&s.jsxs("span",{className:"gas-stations-modal__station-rating",children:["★ ",a.rating.toFixed(1)]}),a.isOpen!==void 0&&s.jsx("span",{className:`gas-stations-modal__station-status ${a.isOpen?"gas-stations-modal__station-status--open":"gas-stations-modal__station-status--closed"}`,children:a.isOpen?"Open":"Closed"})]})]}),s.jsx("a",{href:`https://www.google.com/maps/dir/?api=1&destination=${a.lat},${a.lng}&destination_place_id=${a.placeId}`,target:"_blank",rel:"noopener noreferrer",className:"gas-stations-modal__station-directions",onClick:u=>u.stopPropagation(),children:s.jsx(v,{size:16})})]},a.id))}),s.jsxs("div",{className:"gas-stations-modal__gasbuddy",children:[s.jsx("p",{children:"Want to compare gas prices?"}),s.jsxs("a",{href:`https://www.gasbuddy.com/home?search=${encodeURIComponent(l.lat+","+l.lng)}`,target:"_blank",rel:"noopener noreferrer",className:"gas-stations-modal__gasbuddy-link",children:[s.jsx("img",{src:"https://www.gasbuddy.com/favicon.ico",alt:"GasBuddy",width:"16",height:"16"}),"Compare Prices on GasBuddy",s.jsx(L,{size:14})]})]})]}),s.jsx("div",{className:"gas-stations-modal__map",children:s.jsx(C,{apiKey:M,children:s.jsxs(I,{defaultCenter:l,defaultZoom:13,mapId:"gas-stations-map",gestureHandling:"greedy",disableDefaultUI:!1,zoomControl:!0,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!0,className:"gas-stations-modal__map-element",children:[s.jsx(y,{position:l,children:s.jsx("div",{className:"gas-marker gas-marker--user",children:s.jsx(N,{size:20})})}),n.map(a=>s.jsx(z,{station:a,isSelected:p?.id===a.id,showInfoWindow:b===a.id,onClick:()=>{x(a),j(u=>u===a.id?null:a.id)},onCloseInfoWindow:()=>j(null)},a.id)),s.jsx($,{userLocation:l,onStationsFound:k})]})})})]})]}):null}),s.jsx("div",{className:"gas-stations-modal__footer",children:s.jsx("p",{className:"gas-stations-modal__disclaimer",children:"Gas station locations provided by Google Maps. For real-time prices, visit GasBuddy."})})]})]}):null};P.__docgenInfo={description:"",methods:[],displayName:"GasStationsModal",props:{isOpen:{required:!0,tsType:{name:"boolean"},description:""},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},vehicleName:{required:!1,tsType:{name:"string"},description:""}}};export{P as G};
