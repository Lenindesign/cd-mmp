import{i as w,u as M,r as t,s as k,t as R,j as e}from"./iframe-jrgaLZXw.js";import{X as A}from"./x-B5ESfiSU.js";import{B as S}from"./bookmark-B4e2Hc32.js";import{c as E}from"./createLucideIcon-Cc-7UfB-.js";import{F as G}from"./file-text-hUBECtHz.js";const L=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],z=E("play",L),x="https://accounts.google.com/gsi/client",P=s=>{switch(s){case"vehicle":return"vehicle";case"article":return"article";case"video":return"video";default:return"item"}},U=s=>{switch(s){case"vehicle":return e.jsx(S,{size:20});case"article":return e.jsx(G,{size:20});case"video":return e.jsx(z,{size:20});default:return e.jsx(S,{size:20})}},q=s=>{try{const d=s.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),r=decodeURIComponent(atob(d).split("").map(m=>"%"+("00"+m.charCodeAt(0).toString(16)).slice(-2)).join("")),o=JSON.parse(r);return{id:o.sub,email:o.email,name:o.name,given_name:o.given_name,family_name:o.family_name,picture:o.picture,email_verified:o.email_verified,locale:o.locale}}catch(i){return console.error("Failed to decode JWT:",i),null}},F=({isOpen:s,onClose:i,itemType:d,itemName:r,itemImage:o})=>{const m=w(),{socialSignIn:j}=M(),[_,u]=t.useState(!1),[h,v]=t.useState(!1),[f,g]=t.useState(!1),y=t.useRef(null),l=t.useRef(!1),I=t.useCallback(n=>{console.log("[SignInToSaveModal] Google credential response received");const a=q(n.credential);a?(console.log("[SignInToSaveModal] User decoded:",a.email),k(a),window.dispatchEvent(new CustomEvent("auth-google-signin",{detail:a})),R("google_one_tap",{email:a.email,name:a.name,user_id:a.id}),u(!0),setTimeout(()=>{u(!1),i()},200)):(console.error("[SignInToSaveModal] Failed to decode user information"),v(!1))},[i]);t.useEffect(()=>{if(!s||l.current)return;if(window.google?.accounts?.id){console.log("[SignInToSaveModal] Google script already loaded"),g(!0),l.current=!0;return}const n=document.querySelector(`script[src="${x}"]`);if(n){console.log("[SignInToSaveModal] Script tag exists, waiting for load"),n.addEventListener("load",()=>{g(!0),l.current=!0}),window.google?.accounts?.id&&(g(!0),l.current=!0);return}console.log("[SignInToSaveModal] Loading Google Identity Services script");const a=document.createElement("script");a.src=x,a.async=!0,a.defer=!0,a.onload=()=>{console.log("[SignInToSaveModal] Script loaded"),g(!0),l.current=!0},a.onerror=()=>{console.error("[SignInToSaveModal] Failed to load Google Identity Services script")},document.head.appendChild(a)},[s]),t.useEffect(()=>{!s||!f||y.current},[s,f,I]);const c=()=>{u(!0),setTimeout(()=>{u(!1),i()},200)},T=()=>{c(),m("/sign-in")},b=()=>{c(),m("/sign-up")},C=async()=>{v(!0);try{await j("apple"),c()}catch(n){console.error("Apple sign-in failed:",n),v(!1)}};if(!s)return null;const p=P(d),N=()=>U(d);return e.jsx("div",{className:`save-modal__overlay ${_?"save-modal__overlay--closing":""}`,onClick:c,children:e.jsxs("div",{className:`save-modal ${_?"save-modal--closing":""}`,onClick:n=>n.stopPropagation(),role:"dialog","aria-modal":"true","aria-labelledby":"save-modal-title",children:[e.jsx("button",{className:"save-modal__close",onClick:c,"aria-label":"Close modal",children:e.jsx(A,{size:20})}),e.jsx("div",{className:"save-modal__icon-header",children:e.jsx("div",{className:"save-modal__icon-circle",children:e.jsx(N,{})})}),e.jsxs("div",{className:"save-modal__content",children:[e.jsxs("h2",{id:"save-modal-title",className:"save-modal__title",children:["Sign in to save this ",p]}),r&&e.jsx("p",{className:"save-modal__item-name",children:r}),e.jsxs("p",{className:"save-modal__description",children:["Create a free account to save ",p,"s, get price alerts, and access your research from any device."]}),o&&e.jsx("div",{className:"save-modal__preview",children:e.jsx("img",{src:o,alt:r||`${p} preview`})})]}),e.jsxs("div",{className:"save-modal__actions",children:[e.jsxs("div",{className:"save-modal__social",children:[e.jsxs("button",{className:"save-modal__social-btn save-modal__social-btn--apple",onClick:C,disabled:h,children:[e.jsx("svg",{viewBox:"0 0 24 24",width:"18",height:"18",children:e.jsx("path",{fill:"currentColor",d:"M17.05 20.28c-.98.95-2.05.8-3.08.35-1.09-.46-2.09-.48-3.24 0-1.44.62-2.2.44-3.06-.35C2.79 15.25 3.51 7.59 9.05 7.31c1.35.07 2.29.74 3.08.8 1.18-.24 2.31-.93 3.57-.84 1.51.12 2.65.72 3.4 1.8-3.12 1.87-2.38 5.98.48 7.13-.57 1.5-1.31 2.99-2.54 4.09l.01-.01zM12.03 7.25c-.15-2.23 1.66-4.07 3.74-4.25.29 2.58-2.34 4.5-3.74 4.25z"})}),h?"Signing in...":"Continue with Apple"]}),e.jsx("div",{ref:y,className:"save-modal__google-btn-container",style:{minHeight:"44px"}})]}),e.jsx("div",{className:"save-modal__divider",children:e.jsx("span",{children:"or"})}),e.jsx("button",{className:"save-modal__btn save-modal__btn--primary",onClick:b,children:"Create Free Account"}),e.jsx("button",{className:"save-modal__btn save-modal__btn--secondary",onClick:T,children:"Sign In"})]}),e.jsxs("p",{className:"save-modal__terms",children:["By continuing, you agree to our ",e.jsx("a",{href:"/terms",children:"Terms"})," and ",e.jsx("a",{href:"/privacy",children:"Privacy Policy"})]})]})})};F.__docgenInfo={description:"",methods:[],displayName:"SignInToSaveModal",props:{isOpen:{required:!0,tsType:{name:"boolean"},description:""},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},itemType:{required:!0,tsType:{name:"union",raw:"'vehicle' | 'article' | 'video'",elements:[{name:"literal",value:"'vehicle'"},{name:"literal",value:"'article'"},{name:"literal",value:"'video'"}]},description:""},itemName:{required:!1,tsType:{name:"string"},description:""},itemImage:{required:!1,tsType:{name:"string"},description:""}}};export{z as P,F as S};
