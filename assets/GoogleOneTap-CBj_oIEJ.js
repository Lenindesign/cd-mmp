import{r as l,j as G}from"./iframe-C7N1OJq8.js";const _="cdp_events",v="cdp_registration_source",h="cdp_high_intent_views",D=()=>{try{const e=localStorage.getItem(_);return e?JSON.parse(e):[]}catch{return[]}},p=(e,r={})=>{try{const o=D(),i={event_type:e,timestamp:new Date().toISOString(),properties:r};o.push(i);const a=o.slice(-100);localStorage.setItem(_,JSON.stringify(a))}catch(o){console.error("Failed to track CDP event:",o)}},N=(e,r)=>{p("g1t_prompt_triggered",{page_type:e,vehicle_info:r,url:window.location.href})},q=e=>{p("g1t_prompt_dismissed",{reason:e,url:window.location.href})},R=(e,r)=>{const o={source:e,timestamp:new Date().toISOString(),user_id:r?.user_id,email:r?.email};localStorage.setItem(v,JSON.stringify(o)),p("user_registration",{source:e,...r})},U=()=>{try{const e=localStorage.getItem(v);return e?JSON.parse(e):null}catch{return null}},z=(e,r)=>{const o={page_type:e,vehicle_info:r,timestamp:new Date().toISOString()};try{const i=O();i.push(o);const a=i.slice(-50);localStorage.setItem(h,JSON.stringify(a))}catch(i){console.error("Failed to store high-intent page view:",i)}p("high_intent_page_view",{page_type:e,vehicle_info:r,url:window.location.href})},O=()=>{try{const e=localStorage.getItem(h);return e?JSON.parse(e):[]}catch{return[]}},F=()=>{localStorage.removeItem(_),localStorage.removeItem(v),localStorage.removeItem(h)},H=()=>({events:D(),registration:U(),highIntentViews:O()}),C="770345592048-d0gu8vgcq1eellqeiiq32d6j8r7hd7nb.apps.googleusercontent.com",b="https://accounts.google.com/gsi/client",S="cd_auth_user",J=e=>{try{const o=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),i=decodeURIComponent(atob(o).split("").map(d=>"%"+("00"+d.charCodeAt(0).toString(16)).slice(-2)).join("")),a=JSON.parse(i);return{id:a.sub,email:a.email,name:a.name,given_name:a.given_name,family_name:a.family_name,picture:a.picture,email_verified:a.email_verified,locale:a.locale}}catch(r){return console.error("Failed to decode JWT:",r),null}},V=e=>{localStorage.setItem(S,JSON.stringify(e))},x=()=>{try{const e=localStorage.getItem(S);return e?JSON.parse(e):null}catch{return null}},$=()=>{localStorage.removeItem(S)},K=()=>x()!==null,L=({onSuccess:e,onError:r,onDismiss:o,promptDelay:i=500,pageType:a,vehicleInfo:d,isAuthenticated:c=!1,className:P="",debug:w=!1})=>{const[I,f]=l.useState(!1),[g,E]=l.useState(!1),y=l.useRef(!1),m=l.useRef(!1),n=l.useCallback((...s)=>{w&&console.log("[GoogleOneTap]",...s)},[w]),T=l.useCallback(s=>{n("Credential response received");const t=J(s.credential);if(t)n("User decoded:",t.email),V(t),R("google_one_tap",{email:t.email,name:t.name,user_id:t.id}),e?.(t,s.credential);else{const u="Failed to decode user information";n("Error:",u),r?.(u)}},[e,r,n]),k=l.useCallback(s=>{if(s.isDisplayMoment()){if(s.isDisplayed())n("Prompt displayed"),N(a,d);else if(s.isNotDisplayed()){const t=s.getNotDisplayedReason();n("Prompt not displayed:",t),t==="opt_out_or_no_session"||r?.(`Prompt not displayed: ${t}`)}}if(s.isSkippedMoment()){const t=s.getSkippedReason();n("Prompt skipped:",t)}if(s.isDismissedMoment()){const t=s.getDismissedReason();n("Prompt dismissed:",t),q(t),o?.(t)}},[a,d,r,o,n]);return l.useEffect(()=>{if(m.current||c)return;if(window.google?.accounts?.id){n("Google script already loaded"),f(!0),m.current=!0;return}const s=document.querySelector(`script[src="${b}"]`);if(s){n("Script tag exists, waiting for load"),s.addEventListener("load",()=>{f(!0),m.current=!0});return}n("Loading Google Identity Services script");const t=document.createElement("script");return t.src=b,t.async=!0,t.defer=!0,t.onload=()=>{n("Script loaded"),f(!0),m.current=!0},t.onerror=()=>{const u="Failed to load Google Identity Services script";n("Error:",u),r?.(u)},document.head.appendChild(t),()=>{}},[c,r,n]),l.useEffect(()=>{if(!(!I||g||c)){if(!window.google?.accounts?.id){n("Google Identity Services not available");return}n("Initializing Google One Tap");try{window.google.accounts.id.initialize({client_id:C,callback:T,auto_select:!1,cancel_on_tap_outside:!1,context:"signin",itp_support:!0}),E(!0),n("Initialized successfully")}catch(s){n("Initialization error:",s),r?.(`Initialization failed: ${s}`)}}},[I,g,c,T,r,n]),l.useEffect(()=>{if(!g||c||y.current)return;const s=setTimeout(()=>{window.google?.accounts?.id&&!y.current&&(n(`Showing prompt after ${i}ms delay`),y.current=!0,window.google.accounts.id.prompt(k))},i);return()=>{clearTimeout(s)}},[g,c,i,k,n]),l.useEffect(()=>()=>{window.google?.accounts?.id&&window.google.accounts.id.cancel()},[]),c||!C?null:G.jsx("div",{className:`google-one-tap ${P}`,"data-testid":"google-one-tap"})};L.__docgenInfo={description:`GoogleOneTap Component

Implements Google One Tap authentication for seamless sign-in.
Shows prompt on high-intent pages for non-authenticated users.`,methods:[],displayName:"GoogleOneTap",props:{onSuccess:{required:!1,tsType:{name:"signature",type:"function",raw:"(user: GoogleUser, credential: string) => void",signature:{arguments:[{type:{name:"GoogleUser"},name:"user"},{type:{name:"string"},name:"credential"}],return:{name:"void"}}},description:"Callback when user successfully signs in"},onError:{required:!1,tsType:{name:"signature",type:"function",raw:"(error: string) => void",signature:{arguments:[{type:{name:"string"},name:"error"}],return:{name:"void"}}},description:"Callback when sign-in fails"},onDismiss:{required:!1,tsType:{name:"signature",type:"function",raw:"(reason: string) => void",signature:{arguments:[{type:{name:"string"},name:"reason"}],return:{name:"void"}}},description:"Callback when prompt is dismissed"},promptDelay:{required:!1,tsType:{name:"number"},description:"Delay before showing prompt (ms)",defaultValue:{value:"500",computed:!1}},pageType:{required:!1,tsType:{name:"union",raw:"'mmp' | 'rankings' | 'comparison' | 'pricing' | 'other'",elements:[{name:"literal",value:"'mmp'"},{name:"literal",value:"'rankings'"},{name:"literal",value:"'comparison'"},{name:"literal",value:"'pricing'"},{name:"literal",value:"'other'"}]},description:"Page type for CDP tracking"},vehicleInfo:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  year?: number;
  make?: string;
  model?: string;
  trim?: string;
}`,signature:{properties:[{key:"year",value:{name:"number",required:!1}},{key:"make",value:{name:"string",required:!1}},{key:"model",value:{name:"string",required:!1}},{key:"trim",value:{name:"string",required:!1}}]}},description:"Vehicle info for CDP tracking"},isAuthenticated:{required:!1,tsType:{name:"boolean"},description:"Whether user is already authenticated",defaultValue:{value:"false",computed:!1}},className:{required:!1,tsType:{name:"string"},description:"Custom class name",defaultValue:{value:"''",computed:!1}},debug:{required:!1,tsType:{name:"boolean"},description:"Enable debug logging",defaultValue:{value:"false",computed:!1}}}};export{L as G,F as a,$ as c,H as e,x as g,K as i,z as t};
